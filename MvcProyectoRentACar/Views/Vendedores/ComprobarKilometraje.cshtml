@model List<Reserva>

<div class="container-fluid py-5">
    <div class="container pt-5 pb-3">
        <h1 class="display-4 text-uppercase text-center mb-5">Comprobar Kilometraje</h1>

        @* Filtros *@
        @{
            int filtroActual = (int)(ViewData["Filtro"] ?? 0);
        }
        <div class="mb-3">
            <a href="@Url.Action("ComprobarKilometraje", "Vendedores", new { filtro = 0 })" class="btn btn-primary ajax-filter @(filtroActual == 0 ? "active" : "")">Todas</a>
            <a href="@Url.Action("ComprobarKilometraje", "Vendedores", new { filtro = 1 })" class="btn btn-primary ajax-filter @(filtroActual == 1 ? "active" : "")">Con Kilometraje</a>
            <a href="@Url.Action("ComprobarKilometraje", "Vendedores", new { filtro = 2 })" class="btn btn-primary ajax-filter @(filtroActual == 2 ? "active" : "")">Km Ilimitados</a>
        </div>

        <div id="tablaReservas">
            @Html.Partial("_ComprobarKilometrajeTable", Model)
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="comprobarKmsModal" tabindex="-1" role="dialog" aria-labelledby="comprobarKmsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="comprobarKmsModalLabel">Comprobar Kilometraje</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="comprobarKmsForm" method="post" action="@Url.Action("ComprobarKilometraje", "Vendedores")">
                    <div class="form-group">
                        <label for="newKilometraje">Nuevo Kilometraje</label>
                        <input type="number" class="form-control" id="newKilometraje" name="newKilometraje" required />
                    </div>
                    <input type="hidden" id="idreserva" name="idreserva" />
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <button type="submit" class="btn btn-primary" form="comprobarKmsForm">Guardar cambios</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Update table on filter click using AJAX
        $(document).on("click", ".ajax-filter", function (e) {
            e.preventDefault();
            var url = $(this).attr("href");
            $.get(url, function (data) {
                $("#tablaReservas").html(data);
                $(".ajax-filter").removeClass("active");
            }).done(function () {
                //Mark the clicked filter as active (using 'this' inside the .done callback may not be the element, so we use the URL)
                $('.ajax-filter[href="' + url + '"]').addClass("active");
            });
        });

        // Modal code (unchanged)
        $('#comprobarKmsModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var idReserva = button.data('idreserva');
            console.log("ID Reserva:", idReserva);
            var modal = $(this);
            modal.find('.modal-body #idreserva').val(idReserva);
        });
    </script>
}
